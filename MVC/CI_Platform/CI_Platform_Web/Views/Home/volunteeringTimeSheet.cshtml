@{
    Layout = "_LayoutSingleHeader";
}

@model CI_Platform_Web.Entities.ViewModel.volunteeringTimeSheetViewModel;

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="~/css/volunteeringTimesheet.css" class="rel" />
    <link rel="stylesheet" href="//cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />
    <script src="//cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <title>Document</title>
</head>

<body>
    
    <div class="container maindiv-timesheet">
        <div class="row">
            <div class="col-12">
                <h3 class="titletag">Volunteering Timesheet</h3>
            </div>
            <div class="col-6 ">
                <div class="innerdiv border p-2">
                    <div>
                        <button class="addbtntmsht" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal"><i class="bi bi-plus"></i>ADD</button>

                    </div>

                    <!-- MODAL -->
                    <form asp-action="VolunteeringTimesheet" asp-controller="Home">
                        <input asp-for="missionType" type="text" value="time" hidden />
                        <input asp-for="timesheetPrimary" value="0" type="text" id="primaryIntime" hidden />
                        <div class="fade modal" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">Please Input below volunteering hours</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">

                                        <label for="" class="form-label">Mission</label>
                                        <select asp-for="missionId" class="form-select" aria-label="Default select example" id="selectIntime">
                                            <option selected>Open this select menu</option>
                                            @if (Model.timeMissions != null)
                                            {
                                                @for (int i = 0; i < Model.timeMissions.Count(); i++)
                                                {
                                                    <option value="@Model.timeMissions.ElementAt(i).MissionId">@Model.timeMissions.ElementAt(i).Mission.Title</option>
                                                }
                                            }
                                        </select>             

                                        <label for="" class="form-label">Date Volunteered</label>
                                        <input asp-for="date" type="date" class="form-control" value="@DateTime.Now.Date" id="dateIntime" />
                                        <div class="row">
                                            <div class="col-6">
                                                <label for="" class="form-label col-2">Hours</label>

                                                <input asp-for="hours" type="number" min="0" max="23" class="form-control" id="hourIntime" />
                                            </div>
                                            <div class="col-6">
                                                <label for="" class="form-label ">Minutes</label>

                                                <input asp-for="minutes" type="number" min="0" max="59" class="form-control" id="minuteIntime" />
                                            </div>



                                        </div>
                                        <label for="" class="form-label">Message</label>
                                        <textarea asp-for="message" name="message" id="messageIntime" cols="30" rows="5" class="form-control"></textarea>

                                    </div>
                                    <div class="modal-footer">

                                        <button type="button" class="addSkillsbtnmodal" data-bs-dismiss="modal">Cancel</button>
                                        <button type="submit" class="savebtnmodal">Save</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                    <!-- Modal End -->
                    <span>Volunteering Hours</span>
                    <table class="" style="width: 100%;" id="myTable">
                        <thead>
                            <tr>
                                <th>Mission</th>
                                <th>Date</th>
                                <th>Hours</th>
                                <th>Minutes</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                var k = 0;
                            }
                            @foreach (var i in Model.timeTimesheetList)
                            {
                                <tr id="time_@k">
                                    @{
                                        string j = "";
                                        if (@i.Mission.Title.Length < 25)
                                        {
                                            j = @i.Mission.Title;
                                        }
                                        else
                                        {
                                            j = @i.Mission.Title.Substring(0, 25) + "...";

                                        }

                                    }

                                    <td>@j</td>
                                    <td>@i.DateVolunteered.ToString("dd-MM-yyyy")</td>
                                    <td>@i.Time.ToString().Split(':')[0]</td>
                                    <td>@i.Time.ToString().Split(':')[1]</td>
                                    <td> <i class="bi bi-pencil-square saffron" data-bs-toggle="modal" data-bs-target="#exampleModal" onclick="editRecord(@i.TimesheetId,0)"></i> <i class="bi bi-trash" onclick=remove(@i.TimesheetId,@k,0)></i></td>
                                </tr>

                                k = k + 1;

                            }

                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col-12 col-sm-12 col-md-12 col-lg-6 ">
                <div class="innerdiv border p-2">
                    <div>
                        <button class="addbtntmsht" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModalgoal"><i class="bi bi-plus"></i>ADD</button>
                    </div>
                    <!-- MODAL -->
                    <form asp-action="VolunteeringTimesheet" asp-controller="Home">
                        <input asp-for="missionType" type="text" value="goal" hidden />
                        <input asp-for="timesheetPrimary" type="text" id="primaryIngoal" hidden />
                        <div class="fade modal" id="exampleModalgoal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">Please Input below volunteering hours</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">

                                        <label for="" class="form-label">Mission</label>
                                        <select asp-for="missionId" class="form-select" aria-label="Default select example" id="selectIngoal">
                                            <option selected>Open this select menu</option>
                                            @if (Model.goalMissions != null)
                                            {
                                                @for (int i = 0; i < Model.goalMissions.Count(); i++)
                                                {
                                                    <option value="@Model.goalMissions.ElementAt(i).MissionId">@Model.goalMissions.ElementAt(i).Mission.Title</option>
                                                }

                                            }

                                        </select>

                                        <label for="" class="form-label">Actions</label>
                                        <input asp-for="action" type="number" min="0" class="form-control" id="actionIngoal">
                                        <label for="" class="form-label">Date Volunteered</label>
                                        <input asp-for="date" type="date" class="form-control" value="@DateTime.Now.Date" id="dateIngoal" />





                                        <label for="" class="form-label">Message</label>
                                        <textarea asp-for="message" name="Message" id="messageIngoal" cols="30" rows="5" class="form-control"></textarea>

                                    </div>
                                    <div class="modal-footer">

                                        <button type="button" class="addSkillsbtnmodal" data-bs-dismiss="modal">Cancel</button>
                                        <button type="submit" class="savebtnmodal">Save</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                    <!-- Modal End -->
                    <span>Volunteering Goals</span>
                    <table class="" style="width: 100%;" id="myTable2">
                        <thead>
                            <tr>
                                <th>Mission</th>
                                <th>Date</th>
                                <th>Action</th>

                                <th></th>
                            </tr>
                        </thead>


                        <tbody>
                            @{
                                var p = 0;
                            }
                            @foreach (var i in Model.goalTimesheetList)
                            {
                                <tr id="goal_@p">
                                    @{
                                        string j = "";
                                        if (@i.Mission.Title.Length < 25)
                                        {
                                            j = @i.Mission.Title;
                                        }
                                        else
                                        {
                                            j = @i.Mission.Title.Substring(0, 25) + "...";

                                        }


                                    }

                                    <td>@j</td>
                                    <td>@i.DateVolunteered.ToString("dd-MM-yyyy")</td>
                                    <td>@i.Action</td>

                                    <td> <i class="bi bi-pencil-square saffron" data-bs-toggle="modal" data-bs-target="#exampleModalgoal" onclick="editRecord(@i.TimesheetId,1)"></i> <i class="bi bi-trash" onclick="remove(@i.TimesheetId,@p,1)"></i></td>
                                </tr>

                                p = p + 1;

                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>



    <script>
        function remove(timeSheetId, trId, type) {


            console.log(timeSheetId, trId, type);
            if (type == 0) {
                $('#time_' + trId).remove();
            }
            if (type == 1) {
                $('#goal_' + trId).remove();
            }

            $.ajax({
                url: '/Home/DeleteTimesheetRecord?timesheetId=' + timeSheetId,
                success: function (data) {
                    console.log(data);
                }
            });
        }


        function editRecord(timeSheetId, type) {

            $.ajax({
                url: '/Home/EditTimesheetRecord?timesheetId=' + timeSheetId,
                success: function (data) {
                    console.log(data);
                    if (type == 0) {
                        $('#messageIntime').val(data.notes);
                        $('#selectIntime option[value=' + data.missionId + ']').prop('selected', 'selected').change();
                        console.log(data.dateVolunteered.split('T')[0]);
                        $('#dateIntime').val(data.dateVolunteered.split('T')[0]);
                        $('#hourIntime').val(data.time.split(':')[0]);
                        $('#minuteIntime').val(data.time.split(':')[1]);
                        console.log(data.timesheetId)
                        $('#primaryIntime').val(data.timesheetId);
                    }

                    if (type == 1) {
                        $('#messageIngoal').val(data.notes);
                        $('#selectIngoal option[value=' + data.missionId + ']').prop('selected', 'selected').change();
                        console.log(data.dateVolunteered.split('T')[0]);
                        $('#dateIngoal').val(data.dateVolunteered.split('T')[0]);

                        $('#actionIngoal').val(data.action);
                        console.log(data.timesheetId)
                        $('#primaryIngoal').val(data.timesheetId);
                    }

                }
            })
        }
    </script>

    <script>
        // let table = new DataTable('#myTable');
        let table1 = new DataTable('#myTable2');
        let table = new DataTable('#myTable');
        $('#myTable_wrapper').addClass('margin-top-table')
        $('#myTable2_wrapper').addClass('margin-top-table')
    </script>
</body>

</html>
